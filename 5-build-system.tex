\section{Build system}\label{Build system}

An overview of the components of the \gls{lfl} build system as well as of the methodology of system creation.

\subsection{Layout}

The build system can be subdivided into static and dynamic components.

\subsubsection{Static}

The first are part of the repository prior to running the system build:

\begin{itemize}
    \item \textbf{README.md} - general project information.
    \item \textbf{LICENSE} - project use and distribution terms.
    \item \textbf{Makefile} - listing of make targets with associated scripts.
    \item \textbf{build-scripts} - scripts responsible for each step in the creation of the system.
    \item \textbf{src-lists} - lists of software source code locations.
    \item \textbf{make-scripts} - makefile target scripts.
    \item \textbf{pkg-scripts} - individual package build and install scripts.
    \item \textbf{config-files} - system configuration files.
    \item \textbf{chroot-scripts} - chroot system initialisation scripts.
\end{itemize}

\subsubsection{Dynamic}

The second are created during the system build:

\begin{itemize}
    \item \textbf{archive} - compressed tarballs of source code packages.
    \item \textbf{sources} - uncompressed source code packages or git repositories.
    \item \textbf{rootfs} - the root filesystem of the \gls{lfl} system.
    \item \textbf{isoimage} - all files necessary to generate the iso disk image.
    \item \textbf{linux-for-learners.iso} - the \gls{lfl} disk image.
\end{itemize}

\subsection{Procedure}

A step by step description of the build process.

\subsubsection{Package acquisition}

All software packages required for the system are downloaded. Where available the packages are obtained as compressed tarballs and stored into the archive directory otherwise they are cloned from online repositories via git into the sources directory.

\subsubsection{Source code extraction}

All tarballs found in the archive directory are extracted into the sources directory, while in the case of git repositories a selected commit is checked out. After that all source code patches are applied.

\subsubsection{Root filesystem creation}

A directory tree based upon the \gls{fhs} \cite{fhs} is created in the rootfs directory.

\subsubsection{Software installation}

Each piece of software is built in its respective subdirectory of sources, after which the compiled static binaries are installed into place in the root filesystem along with their associated manual pages.

\subsubsection{System configuration}

All configuration files are copied from the config-files directory tree into corresponding directories in the root filesystem. The ownership of files and directories in rootfs is changed to that of the root user.

\subsubsection{Chroot initialisation}

The final steps required to set up the system are run in isolation on the created root filesystem via chroot and include the indexing of manual pages and the addition of the root user.

\subsubsection{Packaging}

All of the required system components located in the isoimage directory are packaged into an \glsxtrshort{iso} 9660 disk image.

%\noindent
Contents of the isoimage directory:

\begin{itemize}
    \item \textbf{isolinux.bin} - bootloader binary
    \item \textbf{ldlinux.c32} - bootloader dynamic library
    \item \textbf{isolinux.cfg} - bootloader configuration file
    \item \textbf{kernel.gz} - self-extracting compressed Linux kernel image
    \item \textbf{rootfs.gz} - compressed root filesystem archive 
\end{itemize}
